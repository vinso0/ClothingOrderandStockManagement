@model ClothingOrderAndStockManagement.Application.Helpers.PaginatedList<ItemDto>
@using ClothingOrderAndStockManagement.Application.Dtos.Items
@using ClothingOrderAndStockManagement.Application.Helpers
@{
    ViewData["Title"] = "Items";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Items Section -->
<div class="items-section">
    <div class="customer-header section-title">
        <h2>Items</h2>
    </div>

    <!-- Keep your existing search and add section exactly as it was -->
    <div class="entity-search-add">
        <form asp-controller="Items" asp-action="Index" method="get" class="entity-search-form" autocomplete="off">
            <div class="input-group">
                <input type="text" name="searchString" class="form-control" placeholder="Search items..." value="@Context.Request.Query["searchString"]" />
                <button type="submit" class="btn btn-primary d-flex align-items-center">
                    <img src="~/images/icons/Search.png" alt="Search" style="width: 18px; height: 18px;" />
                </button>
            </div>
        </form>

        <button class="btn btn-outline-primary customer-add-btn"
                data-bs-toggle="modal" data-bs-target="#addItemModal">
            <img src="~/images/icons/Add.png" alt="Add" class="add-icon-img" />
            Add Item
        </button>

        @await Html.PartialAsync("Partials/_AddItemModal", new CreateItemDto())
    </div>

    <!-- Keep your existing table structure -->
    <div class="reports-section">
        @if (Model != null && Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover customer-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Category</th>
                            <th>Size</th>
                            <th>Color</th>
                            <th>Quantity</th>
                            <th class="customer-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td><span class="customer-id">@item.ItemId</span></td>
                                <td><span class="customer-name">@item.ItemCategoryType</span></td>
                                <td class="customer-details">@(item.Size ?? "—")</td>
                                <td class="customer-details">@(item.Color ?? "—")</td>
                                <td class="customer-details">
                                    <span class="badge quantity-badge @(item.Quantity > 0 ? "badge-success" : "badge-danger")">
                                        @item.Quantity
                                    </span>
                                </td>
                                <td class="customer-actions">
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-sm btn-outline-info customer-order-btn"
                                                data-bs-toggle="modal" data-bs-target="#detailsItemModal-@item.ItemId">
                                            <img src="~/images/icons/Search.png" alt="Details" style="width: 14px; height: 14px; margin-right: 4px;" />
                                            Details
                                        </button>
                                        @await Html.PartialAsync("Partials/_DetailsItemModal", item)

                                        <a class="btn btn-sm btn-outline-success customer-edit-btn"
                                           data-bs-toggle="modal" data-bs-target="#editItemModal-@item.ItemId">
                                            Edit
                                        </a>
                                        @await Html.PartialAsync("Partials/_EditItemModal", new UpdateItemDto
                                        {
                                            ItemId = item.ItemId,
                                                                ItemCategoryId = item.ItemCategoryId,
                                                                Size = item.Size,
                                                                Color = item.Color,
                                                                Quantity = item.Quantity
                                                                })

                                <button class="btn btn-sm btn-outline-danger customer-delete-btn"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal-@item.ItemId">
                                    Delete
                                </button>
                                @await Html.PartialAsync("_DeleteModal",
                                                                ("Item", "Delete", item.ItemId, $"{item.ItemCategoryType} - {item.Size} - {item.Color}"))
                            </div>
                        </td>
                    </tr>
                                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="no-customers-section">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                    <line x1="8" y1="21" x2="16" y2="21" />
                    <line x1="12" y1="17" x2="12" y2="21" />
                </svg>
                <h5>No items found</h5>
                <p>Start by adding your first item using the "Add Item" button above.</p>
            </div>
        }

        <!-- Keep your existing pagination -->
        <div class="pagination-section">
            <div>
                Page @Model!.PageIndex of @Model!.TotalPages
            </div>
            <div>
                @if (Model.HasPreviousPage)
                {
                    <a asp-action="Index"
                       asp-route-pageIndex="@(Model.PageIndex - 1)"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       class="btn btn-outline-secondary">Previous</a>
                }
                @if (Model.HasNextPage)
                {
                    <a asp-action="Index"
                       asp-route-pageIndex="@(Model.PageIndex + 1)"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       class="btn btn-outline-primary">Next</a>
                }
            </div>
        </div>
    </div>
</div>

<!-- Simple divider between sections -->
<hr class="items-categories-divider" />

<!-- Item Categories Section -->
<div class="categories-section">
    <div class="customer-header section-title">
        <h2>Item Categories</h2>
    </div>

    <!-- Add search form for categories -->
    <div class="customer-search-add-section">
        <!-- Category Search Form -->
        <form asp-controller="Items" asp-action="Index" method="get" class="entity-search-form" autocomplete="off">
            <input type="hidden" name="searchString" value="@ViewData["CurrentFilter"]" />
            <input type="hidden" name="pageIndex" value="@Model.PageIndex" />
            <div class="input-group">
                <input type="text" name="categorySearch" class="form-control" placeholder="Search categories..." value="@ViewData["CategoryCurrentFilter"]" />
                <button type="submit" class="btn btn-primary d-flex align-items-center">
                    <img src="~/images/icons/Search.png" alt="Search" style="width: 18px; height: 18px;" />
                </button>
            </div>
        </form>

        <button class="btn btn-outline-primary customer-add-btn"
                data-bs-toggle="modal" data-bs-target="#addCategoryModal">
            <img src="~/images/icons/Add.png" alt="Add" class="add-icon-img" />
            Add Category
        </button>
    </div>

    <div class="reports-section">
        @if (ViewBag.Categories != null && ((PaginatedList<ItemCategoryDto>)ViewBag.Categories).Any())
        {
            var categories = (PaginatedList<ItemCategoryDto>)ViewBag.Categories;

            <div class="table-responsive">
                <table class="table table-hover customer-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Category Name</th>
                            <th>Items Count</th>
                            <th class="customer-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var category in categories)
                        {
                            <tr>
                                <td><span class="customer-id">@category.ItemCategoryId</span></td>
                                <td><span class="customer-name">@category.ItemCategoryType</span></td>
                                <td class="customer-details">
                                    <span class="badge quantity-badge @(category.ItemsCount > 0 ? "badge-success" : "badge-secondary")">
                                        @category.ItemsCount
                                    </span>
                                </td>
                                <td class="customer-actions">
                                    <div class="btn-group" role="group">
                                        <a class="btn btn-sm btn-outline-success customer-edit-btn"
                                           data-bs-toggle="modal" data-bs-target="#editCategoryModal-@category.ItemCategoryId">
                                            Edit
                                        </a>
                                        <button class="btn btn-sm btn-outline-danger customer-delete-btn"
                                                data-bs-toggle="modal"
                                                data-bs-target="#deleteCategoryModal-@category.ItemCategoryId">
                                            Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Categories Pagination (same style as items) -->
            <div class="pagination-section">
                <div>
                    Page @categories.PageIndex of @categories.TotalPages
                </div>
                <div>
                    @if (categories.HasPreviousPage)
                    {
                        <a asp-action="Index"
                           asp-route-pageIndex="@Model.PageIndex"
                           asp-route-searchString="@ViewData["CurrentFilter"]"
                           asp-route-categorySearch="@ViewData["CategoryCurrentFilter"]"
                           asp-route-categoryPageIndex="@(categories.PageIndex - 1)"
                           class="btn btn-outline-secondary">
                            Previous
                        </a>
                    }

                    @if (categories.HasNextPage)
                    {
                        <a asp-action="Index"
                           asp-route-pageIndex="@Model.PageIndex"
                           asp-route-searchString="@ViewData["CurrentFilter"]"
                           asp-route-categorySearch="@ViewData["CategoryCurrentFilter"]"
                           asp-route-categoryPageIndex="@(categories.PageIndex + 1)"
                           class="btn btn-outline-primary">
                            Next
                        </a>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="no-customers-section">
                <h5>No categories found</h5>
                <p>Create your first category using the "Add Category" button above.</p>
            </div>
        }
    </div>

    <!-- Category Modals - Updated to work with paginated categories -->
    @await Html.PartialAsync("Partials/_AddCategoryModal", ViewData["AddCategoryModel"] as CreateItemCategoryDto ?? new CreateItemCategoryDto())

    @if (ViewBag.Categories != null)
    {
        var categories = (PaginatedList<ItemCategoryDto>)ViewBag.Categories;
        @foreach (var category in categories)
        {
            @await Html.PartialAsync("Partials/_EditCategoryModal", new UpdateItemCategoryDto
            {
                ItemCategoryId = category.ItemCategoryId,
                ItemCategoryType = category.ItemCategoryType
            })

            @await Html.PartialAsync("_DeleteModal", ("Category", "DeleteCategory", category.ItemCategoryId, category.ItemCategoryType))
        }
    }
</div>
